---
title: "Volcano — Расширяемая и параллельная система оценки запросов"
summary: "В целях исследования взаимоотношений возможностей расширения и параллелизма в
обработке запросов БД, мы разработали новую потоковую систему
выполнения запросов, которую мы назвали **Volcano**. Volcano предоставляет
богатую среду для исследований и обучения в области проектирования систем баз
данных, а так же эвристики для оптимизации запросов, их параллельного выполнения
и распределения ресурсов."
date: 2020-01-05T00:02:56+03:00
draft: true
tags:
- volcano
- dynamic query evaluation plans
- extensible database systems
- iterators
- operator model of parallelization
- query execution
---

## Оригинал

Goetz Graefe, [Volcano — An Extensible and Parallel Query Evaluation
System](https://paperhub.s3.amazonaws.com/dace52a42c07f7f8348b08dc2b186061.pdf)

## Aннотaция

В целях исследования взаимоотношений возможностей расширения и параллелизма в
обработке запросов БД, мы разработали новую потоковую (`dataflow`) систему
выполнения запросов, которую мы назвали **Volcano**. Volcano предоставляет
богатую среду для исследований и обучения в области проектирования систем баз
данных, эвристик для оптимизации запросов, их параллельного выполнения
и распределения ресурсов.

Volcano использует стандартный интерфейс между операторами алгебры, что
позволяет легко добавлять новые операторы и так же легко их реализовывать.
Операции над отдельными элементами, например предикатами, импортируются в
операторы обработки запросов с использованием вспомогательных функций (`support
functions`). Семантика вспомогательных функций не прописана; любой тип данных,
включая сложные объекты и любые операции, могут быть реализованы. Таким образом,
Volcano расширяется новыми операторами, алгоритмами, типами данных и методами,
зависящими от типа.

Volcano включает два новых мета-оператора (`meta-operators`: **choose-plan**, 
**exchange**). Мета-оператор выбора плана (`choose-plan`) поддерживает
динамические планы оценки запросов (`dynamic query evaluation plans`), которые
позволяют откладывать выбранные решения по оптимизации до времени выполнения,
например, для встроенных запросов со свободными переменными. Мета-оператор
обмена (`exchange`) поддерживает внутриоператорный параллелизм (`intra-operator
parallelism`) в партиционированных наборах данных, а также
вертикальный и горизонтальный межоператорский параллелизм (`vertical and
horizontal inter-operator parallelism`), переводящий между потоками
данных по запросу внутри процесса и управляемыми данными потоками данных между
процессами.

Все операторы, за исключением оператора обмена (`exchange`), были разработаны
и реализованы в однопроцессной среде и распараллелены с использованием
оператора обмена. Даже операторы, которые еще не разработаны, могут быть
распараллелены с помощью этого нового оператора, если они используют и
предоставляют интерфейс итератора. Таким образом, проблемы манипулирования
данными и параллелизма стали ортогональными, что делает Volcano первым
реализованным механизмом выполнения запросов, который эффективно сочетает
расширяемость и параллелизм.

## I. Введение

Для того, чтобы исследовать взаимодействие расширяемости, эффективности и
параллелизма в обработке запросов к базам данных, а так же, чтобы предоставить
испытательный стенд для исследований и обучения систем баз данных, мы
спроектировали и реализовали новую систему оценки запросов под названием Volcano.
Он предназначен быть экспериментальным инструментом для исследований
методов выполнения запросов и эвристик оптимизаций запросов, а не базой данных,
готовой для поддержки приложений. Это не полноценная база данных, поскольку в
ней отсутствуют такие функции, как удобный для пользователя язык запросов,
система типов для экземпляров (определения записей), оптимизатор запросов и
каталоги. Благодаря этому, Volcano может служить экспериментальным средством
для множества целей, все из которых являются открытыми (open-ended), что приводит
к сочетанию требований, которые ранее не были интегрированы ни в одну систему.

Во-первых, он модульный и расширяемый, что позволяет проводить дальнейшие
исследования, например, по алгоритмам, моделям данных, распределению ресурсов,
параллельному выполнению, балансировке нагрузки и эвристикам оптимизаций
запросов. Таким образом, Volcano обеспечивает инфраструктуру для
экспериментальных исследований, а не конечный исследовательский прототип сам по
себе.

Во-вторых, он прост в своей конструкции, что позволяет студенту использовать и
исследовать. Модульность и простота очень важны для этой цели, потому что они
позволяют студентам начать работать над проектами без понимания всего
внутреннего устройства и всех его деталей. Помимо этого, эти свойства
позволяют вести несколько параллельных студенческих проектов.

В-третьих, дизайн Volcano не предполагает какой-либо конкретной модели данных;
единственное предположение состоит в том, что обработка запросов основана на
преобразовании наборов элементов с использованием параметризованных операторов.
Для достижения независимости модели данных проект последовательно отделяет
управление обработкой множества (которое предоставляется и присуще операторам
Volcano) от интерпретации и манипулирования элементами данных (которые
импортируются в операторы, как описано ниже).

В-четвертых, освободить разработку алгоритмов, реализацию, отладку, настройку и
первоначальные эксперименты от сложностей параллелизма, но позволить
эксперименты с параллельной обработкой запросов. Volcano может использоваться
как однопроцессная или как параллельная система. Планы оценки однопроцессных
запросов уже можно легко распараллелить на машинах с общей памятью, а вскоре это
может быть сделано и на машинах с распределенной памятью.

В-пятых, Volcano достаточно реалистичен в своей парадигме выполнения запросов,
чтобы студенты могли узнать, как на самом деле выполняется обработка запросов в
коммерческих базах данных. Так, например, использование временных файлов для
передачи данных из одной операции в другую, как предлагается в большинстве
учебников, существенно снижает производительность и поэтому не используется
ни в реальных базах данных, ни в Volcano.

И наконец, способы параллельной обработки запросов Volcano не могли быть
основаны на существующих образцах, поскольку все образцы, исследованные до
настоящего времени, были разработаны с учетом конкретной для каждой ситуации
модели данных и набора операторов. Вместо этого, цель нашего дизайна состояла в
том, чтобы сделать параллелизм и манипулирование данными ортогональными, что
означает, что механизмы параллельной обработки запросов не зависят от набора
операторов и семантики, и что все операторы, включая новые, могут быть
разработаны и реализованы независимо.

Следуя принципу проектирования, хорошо зарекомендовавшему себя в исследованиях
операционных систем, но не использовавшемуся в большинстве систем баз данных,
Volcano предоставляет механизмы поддержки политик. Политики могут быть
установлены экспериментатором или оптимизатором запросов. Разделение механизмов
и политик способствовало расширяемости и модульности современных операционных
систем и может внести такой же вклад в расширяемые системы баз данных. Мы ещё
вернемся к этому разделению неоднократно в этой статье.

Volcano постоянно модифицируется и расширяется, поскольку в этом и заключалась
одна из основных задач при его создании. Среди наиболее важных недавних
расширений были разработка и реализация двух мета-операторов. Они являются
не только новыми операторами, но также воплощают и инкапсулируют новые концепции
для обработки запросов. Они являются мета-операторами, поскольку они не
способствуют манипулированию данными, их выбору, деривации и т.д. А вместо
этого обеспечивают дополнительный контроль над обработкой запросов, который не
может быть обеспечен обычными операторами, такими как сканирование файлов,
сортировка и объединение слиянием. Оператор выбора плана (**choose-plan**)
реализует концепцию, разработанную для запросов, которые должны быть
оптимизированы с неполной информацией
[[17][17]] - динамические планы оценки запросов (**dynamic query evaluation plans**).

[17]: https://people.inf.elte.hu/kiss/cikkek/092%20Dynamic%20query%20evaluation%20(9%20oldal).pdf
      "G. Graefe and K. Ward, 'Dynamic query evaluation plans' in Proc. ACM SIGMOD Conf. Portland, OR, May-June 1989, p.358"

Например, невозможно надежно оптимизировать встроенный запрос, если одна из
констант в предикате запроса является переменной и, следовательно, неизвестна
во время компиляции и оптимизации. Динамические планы позволяют подготовить
несколько эквивалентных планов, каждый из которых оптимален для определенного
диапазона фактических значений параметров. Оператор выбора плана (**choose-plan**)
выбирает среди этих планов во время выполнения, в то время как все другие
операторы в наборе операторов Volcano (нынешние или будущие) полностью не
замечают наличия и функции оператора выбора плана.

Второй мета-оператор, оператор обмена (**exchange**), реализует и контролирует
параллельную оценку запросов в Volcano. В рамках одного процесса операторы могут
обмениваться данными без оператора обмена так же легко, как и при вызове
одной процедуры. Новый же оператор позволяет обменивается данными через границы
процессов и процессоров. Все остальные операторы реализованы и выполняются без
учета параллелизма; все проблемы параллелизма, такие как секционирование
(**partitioning**) и управление потоком (**flow control**), инкапсулированы и
предоставляются оператором обмена. Таким образом, манипулирование данными и
параллелизм действительно являются ортогональными в Volcano [[20][20]]. Помимо
чистоты с точки зрения разработки программного обеспечения, также очень приятно
видеть, что этот метод распараллеливания обработки запросов действительно
обеспечивает линейное или почти линейное ускорение [[18][18]].

[18]: https://dl.acm.org/doi/abs/10.1002/spe.4380220702
      "G. Graefe and S. S. Thakkar 'Tuning a parallel database algorithm on a shared-memory multiprocessor'
      Software—Practice & ExperienceJuly, Vol.22, no. 7, July 1992, p.485"
[20]: https://dl.acm.org/doi/10.1145/93597.98720
      "G. Graefe 'Encapsulation of parallelism in the Volcano query processing system'
      in Proc. ACM SIGMOD Conf. Atlantic City, NJ, May 1990, p.102"

Эта статья представляет собой обзор, описывающий общие цели и принципы
проектирования. Особые аспекты Volcano были описаны в других статьях:
[[16][16]], [[17][17]], [[18][18]], [[19][19]], [[20][20]], [[21][21]], [[25][25]],
[[26][26]]. Следующие статьи также включают экспериментальные оценки
производительности методов и алгоритмов Volcano: [[18][18]], [[21][21]].

[16]: https://www.computer.org/csdl/proceedings-article/icde/1989/00047204/12OmNwpoFBc
      "G. Graefe, 'Relational division: four algorithms and their performance'
      in Proc. IEEE Conf. Data Eng., Los Angeles, CA, Feb. 1989, p.94"
[19]: https://dl.acm.org/doi/10.1109/32.238579 "G. Graefe and D. Davison
      'Encapsulation of Parallelism and Architecture-Independence in Extensible
      Database Query Execution' in IEEE Transactions on Software Engineering,
      Vol. 19, No. 8, August 1993" 
[21]: https://scholar.colorado.edu/cgi/viewcontent.cgi?article=1440&context=csci_techreports
      "G. Graefe, 'Parallel external sorting in Volcano', CU Boulder Comput.
      Sci. Tech. Rep. 459, Feb 1990"
[25]: https://pdfs.semanticscholar.org/8348/3f22089dffba85effdac7686aa82ee6b9583.pdf
      "T. Keller and G. Graefe 'The One-to-one Match Operator of the Volcano
      Query Processing System' Oregon Grad. Center, Comput. Sci. Tech. Rep.,
      Beaverton, OR, June 1989."
[26]: https://dl.acm.org/doi/10.1145/119995.115809 "T. Keller, G. Graefe, and D.
      Maier, 'Efficient assembly for complex objects' Proc. ACM SIGMOD
      Conf., Denver, CO, May 1991, p.148"

Настоящая статья организована следующим образом. В следующем разделе (II) мы
кратко рассмотрим предыдущую работу, которая повлияла на дизайн Volcano. В
разделе III будет подробное описание Volcano. Раздел IV содержит обсуждение
расширяемости в системе. Планы динамической оценки запросов и их реализация
будут описаны в разделе V. Параллельная обработка, инкапсулированная в модуле
обмена, описана в разделе VI. Раздел VII содержит краткое резюме и наши выводы.

## II. Связанная работа

Поскольку для эффективной обработки больших наборов данных было разработано
очень много различных систем, мы рассматриваем только те системы, которые
существенно повлияли на конструкцию Volcano. Cильнее всего повлияли следущие:
WiSS, GAMMA и EXODUS. Wisconsin Storage System (WiSS) [[10][10]] - это
файловая система, ориентированная на записи, предоставляющая файлы кучи, B-tree
и хеш индексы, буферизацию и сканирование с использованием предикатов. GAMMA
[[11][11]] - это база данных, работающая на нескольких процессорах общего
назначения в качестве бэкэнда для UNIX машин. Он был разработан на 17 VAX
11/750, соединенных между собой и хостом VAX 11/750 80 Мбит/с токен-кольцо.
Восемь процессоров GAMMA имели локальное дисковое устройство, доступ к которому
осуществлялся с помощью WiSS. Диски были доступны только локально, а операторы
обновления и выбора использовали только эти восемь процессоров. Другие,
бездисковые процессоры, использовались для обработки объединений (**join**).
Недавно программное обеспечение GAMMA было портировано на гиперкуб Intel iPSC/2
с 32 узлами, каждый с локальным диском. GAMMA широко использует алгоритмы на
основе хешей, реализованные таким образом, что каждый оператор выполняется на
нескольких (обычно всех) процессорах, а входной поток для каждого оператора
разбивается на непересекающиеся множества в соответствии с хеш-функцией.

[10]: https://dl.acm.org/doi/10.1002/spe.4380151003 "H. T. Chou, D. J. DeWitt,
      R. H. Katz, A. C. Klug 'Design and implementation of the Wisconsin storage
      system' Software—Practice Experience, Vol. 15, No. 10, p.943, Oct. 1985"
[11]: https://dl.acm.org/doi/10.1109/69.50905 "D. J. Dewitt, S. Ghandeharizadeh,
      D. A. Schneider, A. Bricker, H. I. Hsiao, R. Rasmussen, 'The Gamma
      Database Machine Project' IEEE Trans. Knowledge Data Eng. Vol. 2, p. 44,
      Mar 1990"

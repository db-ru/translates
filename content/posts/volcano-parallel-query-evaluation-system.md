---
title: "Volcano — Расширяемая и параллельная система оценки запросов"
summary: "В целях исследования взаимоотношений возможностей расширения и параллелизма в
обработке запросов БД, мы разработали новую потоковую систему
выполнения запросов, которую мы назвали **Volcano**. Volcano предоставляет
богатую среду для исследований и обучения в области проектирования систем баз
данных, а так же эвристики для оптимизации запросов, их параллельного выполнения
и распределения ресурсов."
date: 2020-01-05T00:02:56+03:00
draft: true
tags:
- volcano
- dynamic query evaluation plans
- extensible database systems
- iterators
- operator model of parallelization
- query execution
---

## Оригинал

Goetz Graefe, [Volcano — An Extensible and Parallel Query Evaluation
System](https://paperhub.s3.amazonaws.com/dace52a42c07f7f8348b08dc2b186061.pdf)

## Aннотaция

В целях исследования взаимоотношений возможностей расширения и параллелизма в
обработке запросов БД, мы разработали новую потоковую (`dataflow`) систему
выполнения запросов, которую мы назвали **Volcano**. Volcano предоставляет
богатую среду для исследований и обучения в области проектирования систем баз
данных, эвристик для оптимизации запросов, их параллельного выполнения
и распределения ресурсов.

Volcano использует стандартный интерфейс между операторами алгебры, что
позволяет легко добавлять новые операторы и так же легко их реализовывать.
Операции над отдельными элементами, например предикатами, импортируются в
операторы обработки запросов с использованием вспомогательных функций (`support
functions`). Семантика вспомогательных функций не прописана; любой тип данных,
включая сложные объекты и любые операции, могут быть реализованы. Таким образом,
Volcano расширяется новыми операторами, алгоритмами, типами данных и методами,
зависящими от типа.

Volcano включает два новых мета-оператора (`meta-operators`: **choose-plan**, 
**exchange**). Мета-оператор выбора плана (`choose-plan`) поддерживает
динамические планы оценки запросов (`dynamic query evaluation plans`), которые
позволяют откладывать выбранные решения по оптимизации до времени выполнения,
например, для встроенных запросов со свободными переменными. Мета-оператор
обмена (`exchange`) поддерживает внутриоператорный параллелизм (`intra-operator
parallelism`) в партиционированных наборах данных, а также
вертикальный и горизонтальный межоператорский параллелизм (`vertical and
horizontal inter-operator parallelism`), переводящий между потоками
данных по запросу внутри процесса и управляемыми данными потоками данных между
процессами.

Все операторы, за исключением оператора обмена (`exchange`), были разработаны
и реализованы в однопроцессной среде и распараллелены с использованием
оператора обмена. Даже операторы, которые еще не разработаны, могут быть
распараллелены с помощью этого нового оператора, если они используют и
предоставляют интерфейс итератора. Таким образом, проблемы манипулирования
данными и параллелизма стали ортогональными, что делает Volcano первым
реализованным механизмом выполнения запросов, который эффективно сочетает
расширяемость и параллелизм.

## 1. Введение

Для того, чтобы исследовать взаимодействие расширяемости, эффективности и
параллелизма в обработке запросов к базам данных, а так же, чтобы предоставить
испытательный стенд для исследований и обучения систем баз данных, мы
спроектировали и реализовали новую систему оценки запросов под названием Volcano.
Он предназначен быть экспериментальным инструментом для исследований
методов выполнения запросов и эвристик оптимизаций запросов, а не базой данных,
готовой для поддержки приложений. Это не полноценная база данных, поскольку в
ней отсутствуют такие функции, как удобный для пользователя язык запросов,
система типов для экземпляров (определения записей), оптимизатор запросов и
каталоги. Благодаря этому, Volcano может служить экспериментальным средством
для множества целей, все из которых являются открытыми (open-ended), что приводит
к сочетанию требований, которые ранее не были интегрированы ни в одну систему.

Во-первых, он модульный и расширяемый, что позволяет проводить дальнейшие
исследования, например, по алгоритмам, моделям данных, распределению ресурсов,
параллельному выполнению, балансировке нагрузки и эвристикам оптимизаций
запросов. Таким образом, Volcano обеспечивает инфраструктуру для
экспериментальных исследований, а не конечный исследовательский прототип сам по
себе.

Во-вторых, он прост в своей конструкции, что позволяет студенту использовать и
исследовать. Модульность и простота очень важны для этой цели, потому что они
позволяют студентам начать работать над проектами без понимания всего
внутреннего устройства и всех его деталей. Помимо этого, эти свойства
позволяют вести несколько параллельных студенческих проектов.

В-третьих, дизайн Volcano не предполагает какой-либо конкретной модели данных;
единственное предположение состоит в том, что обработка запросов основана на
преобразовании наборов элементов с использованием параметризованных операторов.
Для достижения независимости модели данных проект последовательно отделяет
управление обработкой множества (которое предоставляется и присуще операторам
Volcano) от интерпретации и манипулирования элементами данных (которые
импортируются в операторы, как описано ниже).

В-четвертых, освободить разработку алгоритмов, реализацию, отладку, настройку и
первоначальные эксперименты от сложностей параллелизма, но позволить
эксперименты с параллельной обработкой запросов. Volcano может использоваться
как однопроцессная или как параллельная система. Планы оценки однопроцессных
запросов уже можно легко распараллелить на машинах с общей памятью, а вскоре это
может быть сделано и на машинах с распределенной памятью.

В-пятых, Volcano достаточно реалистичен в своей парадигме выполнения запросов,
чтобы студенты могли узнать, как на самом деле выполняется обработка запросов в
коммерческих базах данных. Так, например, использование временных файлов для
передачи данных из одной операции в другую, как предлагается в большинстве
учебников, существенно снижает производительность и поэтому не используется
ни в реальных базах данных, ни в Volcano.

И наконец, способы параллельной обработки запросов Volcano не могли быть
основаны на существующих образцах, поскольку все образцы, исследованные до
настоящего времени, были разработаны с учетом конкретной для каждой ситуации
модели данных и набора операторов. Вместо этого, цель нашего дизайна состояла в
том, чтобы сделать параллелизм и манипулирование данными ортогональными, что
означает, что механизмы параллельной обработки запросов не зависят от набора
операторов и семантики, и что все операторы, включая новые, могут быть
разработаны и реализованы независимо.

Следуя принципу проектирования, хорошо зарекомендовавшему себя в исследованиях
операционных систем, но не использовавшемуся в большинстве систем баз данных,
Volcano предоставляет механизмы поддержки политик. Политики могут быть
установлены экспериментатором или оптимизатором запросов. Разделение механизмов
и политик способствовало расширяемости и модульности современных операционных
систем и может внести такой же вклад в расширяемые системы баз данных. Мы ещё
вернемся к этому разделению неоднократно в этой статье.

Volcano постоянно модифицируется и расширяется, поскольку в этом и заключалась
одна из основных задач при его создании. Среди наиболее важных недавних
расширений были разработка и реализация двух мета-операторов. Они являются
не только новыми операторами, но также воплощают и инкапсулируют новые концепции
для обработки запросов. Они являются мета-операторами, поскольку они не
способствуют манипулированию данными, их выбору, деривации и т.д. А вместо
этого обеспечивают дополнительный контроль над обработкой запросов, который не
может быть обеспечен обычными операторами, такими как сканирование файлов,
сортировка и объединение слиянием. Оператор выбора плана (**choose-plan**)
реализует концепцию, разработанную для запросов, которые должны быть
оптимизированы с неполной информацией
[[17][17]] - динамические планы оценки запросов (**dynamic query evaluation plans**).

[17]: https://people.inf.elte.hu/kiss/cikkek/092%20Dynamic%20query%20evaluation%20(9%20oldal).pdf
      "G. Graefe and K. Ward, 'Dynamic query evaluation plans' in Proc. ACM SIGMOD Conf. Portland, OR, May-June 1989, p.358"

Например, невозможно надежно оптимизировать встроенный запрос, если одна из
констант в предикате запроса является переменной и, следовательно, неизвестна
во время компиляции и оптимизации. Динамические планы позволяют подготовить
несколько эквивалентных планов, каждый из которых оптимален для определенного
диапазона фактических значений параметров. Оператор выбора плана (**choose-plan**)
выбирает среди этих планов во время выполнения, в то время как все другие
операторы в наборе операторов Volcano (нынешние или будущие) полностью не
замечают наличия и функции оператора выбора плана.

Второй мета-оператор, оператор обмена (**exchange**), реализует и контролирует
параллельные вычисления запросов в Volcano.
